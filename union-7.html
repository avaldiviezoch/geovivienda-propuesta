<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoVivienda — Propuesta (menu + carátula + cifras + Geovisor)</title>
  <meta name="color-scheme" content="light dark" />
  <link href="https://fonts.googleapis.com/css2?family=Forum&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fff6f3;        
      --ink:#1d212a;       
      --muted:#5e6472;     
      --stroke:#e6e0de;    
      --brand:#c62a4b;     
      --brand-ink:#fff;    
      --glass: color-mix(in srgb, #ffffff 65%, transparent);
      --maxw: 1200px;

      --rojo:#e85564; --rojo2:#ff847c;
      --card-h:260px; --hdr-h:72px; --gap:24px; --radius:12px;
      --elev0:0 4px 8px rgba(0,0,0,.10); --elev1:0 10px 18px rgba(0,0,0,.18);
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%;scroll-behavior:smooth}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background:linear-gradient(180deg, var(--bg) 0%, color-mix(in srgb, var(--bg) 90%, var(--brand) 10%) 70%);
      background-size: 100% 200%;
      animation: bgShift 12s ease-in-out infinite alternate;
      color:var(--ink)
    }
    @keyframes bgShift { 0% {background-position:0% 0%} 100% {background-position:0% 100%} }

    /* HEADER */
    header.site{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(140%) blur(8px);
      background:var(--glass);
      border-bottom:1px solid var(--stroke);
      box-shadow:0 2px 8px rgba(0,0,0,.05);
    }
    .navwrap{
      max-width:var(--maxw); margin-inline:auto;
      padding:clamp(8px,2.4vw,14px) clamp(12px,3.6vw,24px);
      display:flex; align-items:center; gap:14px; justify-content:space-between;
    }
    .logo{display:flex; align-items:center; gap:.6rem; text-decoration:none; color:inherit; transition:transform .3s}
    .logo:hover{transform:scale(1.05)}
    .logo img{height:36px; width:auto; border-radius:10px; border:1px solid var(--stroke); background:#fff; transition:box-shadow .3s}
    .logo:hover img{box-shadow:0 0 12px rgba(198,42,75,.3)}
    .logo span{font-weight:800}
    nav ul{list-style:none; display:flex; gap:clamp(10px,2.4vw,20px); margin:0; padding:0; flex-wrap:wrap}
    nav a{ text-decoration:none; color:inherit; font-weight:600; opacity:.85; padding:.45rem .7rem; border-radius:10px; position:relative; transition:all .3s}
    nav a::after{
      content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%) scaleX(0);
      width:60%; height:2px; background:var(--brand); opacity:0; transition:transform .3s, opacity .3s;
    }
    nav a:hover{ background:#fff6; opacity:1; transform:translateY(-2px); box-shadow:0 4px 12px rgba(198,42,75,.2) }
    nav a:hover::after{ transform:translateX(-50%) scaleX(1); opacity:.8 }
    nav a.active{ color:var(--brand) }
    nav a.active::after{ transform:translateX(-50%) scaleX(1); opacity:1 }

    .cta{ margin-left:auto }
    .btn{
      display:inline-flex; align-items:center; gap:.5rem; font-weight:700;
      padding:.6rem 1rem; border-radius:999px; border:1px solid var(--brand);
      background:var(--brand); color:var(--brand-ink); text-decoration:none;
      box-shadow:0 8px 20px rgba(198,42,75,.18); transition:all .3s; animation:pulse 2s ease-in-out infinite;
    }
    .btn:hover{ transform:scale(1.05); box-shadow:0 10px 24px rgba(198,42,75,.3) }
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

    /* COVER */
    .cover{
      position:relative; 
      min-height: clamp(580px, 90dvh, 880px); 
      background: linear-gradient(to bottom, var(--bg) 0%, color-mix(in srgb, var(--bg) 70%, var(--rojo) 30%) 100%);
      overflow:hidden; 
      border-bottom:1px solid var(--stroke);
    }
    .cover .container{
      max-width:var(--maxw); margin-inline:auto;
      padding:clamp(20px,5vw,40px) clamp(12px,3.6vw,24px);
      display:grid; align-items:center; gap:clamp(16px,4vw,28px);
      grid-template-columns:1.2fr .9fr;
    }
    @media (max-width:980px){ .cover .container{ grid-template-columns:1fr } }

    .title{ font-size:clamp(28px,5vw,64px); line-height:1.04; margin:.2rem 0 .6rem; font-weight:800; opacity:0; animation:fadeInUp 1s ease forwards }
    .title span{display:inline-block; opacity:0; transform:translateY(20px); animation:letterPop .6s ease forwards; animation-delay:calc(.05s * var(--i))}
    @keyframes fadeInUp{0%{opacity:0;transform:translateY(30px)}100%{opacity:1;transform:translateY(0)}}
    @keyframes letterPop{0%{opacity:0;transform:translateY(20px)}100%{opacity:1;transform:translateY(0)}}

    .subtitle{ color:var(--muted); font-size:clamp(14px,1.3vw,18px); max-width:68ch; opacity:0; animation:fadeInUp 1s ease forwards .5s }
    .actions{ display:flex; gap:.6rem; flex-wrap:wrap; margin-top:12px }
    .btn.ghost{ background:#fff; color:var(--ink); border-color:var(--stroke); animation:none }
    .btn.ghost:hover{ background: color-mix(in srgb, var(--brand) 10%, #fff); transform:scale(1.05) }

    .art{ position:relative; text-align:center }
    .art img{ width:100%; max-width:480px; height:auto; display:block; margin:auto; opacity:0; transform:scale(.8) rotate(-5deg); animation:artPop 1.2s ease forwards .6s, floaty 6s ease-in-out infinite 1.8s; position:relative; z-index:1 }
    @keyframes artPop{0%{opacity:0;transform:scale(.8) rotate(-5deg)}100%{opacity:1;transform:scale(1) rotate(0)}}
    @keyframes floaty{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-12px) rotate(1deg)}}

    .cover::before{
      content:''; position:absolute; inset:0;
      background: radial-gradient(circle at 70% 20%, rgba(198,42,75,.2) 0%, transparent 50%);
      opacity:0; animation:particleBurst 2s ease-out forwards 1s; pointer-events:none; z-index:0;
    }
    @keyframes particleBurst{0%{opacity:0;transform:scale(.5)}50%{opacity:.4}100%{opacity:0;transform:scale(1.5)}}

    /* Apartado informativo */
    .info-apartado{
      max-width:var(--maxw); margin-inline:auto;
      padding:clamp(18px,4vw,34px) clamp(12px,3.6vw,24px);
      background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
      text-align:center; 
      font-size:clamp(14px,1.6vw,18px);
      line-height:1.6;
      color:color-mix(in srgb, var(--muted) 90%, #000 10%);
      text-wrap:balance;
      text-shadow:0 1px 0 rgba(255,255,255,.6);
      opacity:0; transform:translateY(10px); animation:fadeSlideUp 1s ease forwards 1.0s;
    }
    @keyframes fadeSlideUp{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}

    /* NUESTRAS CIFRAS */
    .stats{
      background: linear-gradient(to bottom, var(--rojo) 0%, var(--brand) 100%);
      color:var(--brand-ink);
      padding: clamp(42px, 7vw, 88px) clamp(18px, 5vw, 42px);
      text-align:center;
      font-family:"Forum", Georgia, serif;
      opacity:0; transform:translateY(30px); animation:fadeSlideUp 1s ease forwards 1.5s;
    }
    .stats .wrap{ max-width:var(--maxw); margin:0 auto }
    .stats h2{ margin:0 0 clamp(26px, 3.8vw, 44px); font-size:clamp(22px,3.4vw,40px); font-weight:400; letter-spacing:.2px }

    .kpis{
      display:grid;
      grid-template-columns: 1fr auto 1fr auto 1fr auto 1fr;
      gap:clamp(14px,3.4vw,34px);
      align-items:center;
    }
    .kpi-sep{ display:flex; align-items:center; justify-content:center; font-size:clamp(22px,3.2vw,34px); line-height:1; user-select:none }
    @media (max-width:900px){ .kpis{grid-template-columns:1fr} .kpi-sep{display:none} }

    .counter{ display:flex; flex-direction:column; align-items:center; gap:10px }
    .slot{ display:inline-flex; align-items:baseline; line-height:1; gap:.26em }
    .digit{ font-variant-numeric:tabular-nums; font-weight:400; font-size:clamp(28px,5vw,48px); letter-spacing:.01em; min-width:.60em; text-align:center; text-shadow:0 1px 2px rgba(0,0,0,.12) }
    .sep{ font-weight:400; font-size:clamp(28px,5vw,48px); margin:0 .14em; line-height:1; display:inline-flex; align-items:center; justify-content:center; text-shadow:0 1px 2px rgba(0,0,0,.12) }
    .label{ font-size:clamp(12px,1.6vw,15px); opacity:.95 }
    .footnote{ margin-top:clamp(18px,3vw,26px); font-size:11px; opacity:.9 }

    /* RAMIFICACIÓN (por defecto en “pausa”) */
    .conector{width:680px;margin:40px auto 32px;position:relative;isolation:isolate;z-index:0}
    .fila{display:flex;justify-content:space-between;position:relative}
    .nodo{
      position:relative;width:200px;height:200px;border-radius:16px;border:2px solid #e0e0e0;
      background: linear-gradient(to bottom, #fff, color-mix(in srgb, #fff 80%, var(--rojo) 20%));
      display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,.1);z-index:1
    }
    .nodo img{width:100%;height:100%;object-fit:cover;object-position:center;border-radius:14px;position:relative;z-index:2}

    .fila.superior::before,
    .fila.superior::after{
      content:"";position:absolute;top:50%;height:4px;
      background: linear-gradient(to right, transparent, var(--rojo), transparent);
      transform:scaleX(0);transform-origin:left;z-index:-1;
    }
    .fila.superior::after{transform-origin:right}

    .nodo.rama::after{
      content:"";position:absolute;top:100%;left:50%;width:4px;height:100px;
      background: linear-gradient(to bottom, var(--rojo), transparent);
      transform-origin:top center;transform:scaleY(0);z-index:-1;
    }
    .fila.inferior{margin-top:100px;justify-content:space-between;overflow:visible;position:relative}
    .fila.inferior::after{
      content:"";position:absolute;top:50%;left:50%;width:6px;height:100px;
      background:linear-gradient(to bottom, var(--rojo), var(--rojo2), transparent);
      transform-origin:top;transform:scaleY(0);z-index:-1;box-shadow:0 0 10px rgba(232,85,100,.5)
    }
    .nodo.join-left::after,.nodo.join-right::after{
      content:"";position:absolute;top:50%;height:4px;
      background: linear-gradient(to right, transparent, var(--rojo), transparent);
      width:140px;transform:scaleX(0);z-index:-2
    }
    .nodo.join-left::after{left:100%;transform-origin:left}
    .nodo.join-right::after{right:100%;transform-origin:right}

    /* Cuando el bloque entra a vista, arrancan las animaciones */
    .conector.is-inview .fila.superior::before{ left:200px;width:140px; animation:dibujarLineaSupIzq 2s ease-out forwards }
    .conector.is-inview .fila.superior::after { left:340px;width:140px; animation:dibujarLineaSupDer 2s ease-out forwards }
    .conector.is-inview .nodo.rama::after     { animation:dibujarRama 1.2s ease-out forwards 2s }
    .conector.is-inview .fila.inferior::after { animation:dibujarLineaAbajo 1.6s ease-out forwards 3.2s }
    .conector.is-inview .nodo.join-left::after{ animation:dibujarLineaIzq 2.4s ease-out forwards 2.2s }
    .conector.is-inview .nodo.join-right::after{animation:dibujarLineaDer 2.4s ease-out forwards 2.2s }

    @keyframes dibujarLineaSupIzq {to{transform:scaleX(1)}} 
    @keyframes dibujarLineaSupDer {to{transform:scaleX(1)}}
    @keyframes dibujarRama        {to{transform:scaleY(1)}}
    @keyframes dibujarLineaIzq    {to{transform:scaleX(1)}}
    @keyframes dibujarLineaDer    {to{transform:scaleX(1)}}
    @keyframes dibujarLineaAbajo  {to{transform:scaleY(1)}}

    /* GEOVISOR */
    .wrapper{max-width:1100px;margin:0 auto;padding:36px 20px;perspective:1200px}
    .section{margin-bottom:36px}
    .section-title{text-align:center;font-size:28px;font-weight:800;color:var(--rojo);margin:8px 0 20px}
    .cards-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--gap)}
    .cards-row.cols-3{grid-template-columns:repeat(3,minmax(280px,1fr))}
    .cards-row.cols-3 .card:first-child{grid-column:2;justify-self:center}
    @media (max-width:900px){.cards-row.cols-3{grid-template-columns:repeat(2,minmax(260px,1fr))}.cards-row.cols-3 .card:first-child{grid-column:1 / -1}}
    @media (max-width:560px){.cards-row.cols-3{grid-template-columns:1fr}}
    .card{
      position:relative;height:var(--card-h);background: linear-gradient(to bottom, #fff, color-mix(in srgb, #fff 90%, var(--rojo) 10%));
      border-radius:var(--radius);border:1px solid #efe9e9;overflow:hidden;display:flex;flex-direction:column;
      box-shadow:var(--elev0);transition:box-shadow .25s ease,transform .6s ease,opacity .6s ease;
      transform-style:preserve-3d;opacity:1;transform:translateZ(0) scale(1) /* sin entrada diferida aquí */
    }
    .card:hover{box-shadow:var(--elev1);transform:scale(1.03)}
    .card-header{
      height:var(--hdr-h);display:flex;align-items:center;justify-content:space-between;
      padding:0 16px;background: linear-gradient(to right, var(--rojo), var(--rojo2));
      color:#fff;font-weight:700;letter-spacing:.2px
    }
    .card-icon{width:26px;height:26px;display:flex;align-items:center;justify-content:center;color:#fff}
    .card-icon svg{width:100%;height:100%;fill:currentColor}
    .card-body{flex:1;padding:12px 16px 16px;font-size:14px;line-height:1.45;color:#2f3845;overflow:hidden;
      display:-webkit-box;-webkit-line-clamp:6;-webkit-box-orient:vertical}

    .geovisor-stage{position:relative}
    .geovisor-stage::before{
      content:"";position:absolute;top:-80px;left:50%;transform:translateX(-50%) scale(.7);
      width:min(1000px,95vw);height:600px;pointer-events:none;z-index:0;
      background:radial-gradient(ellipse at 50% 0%, rgba(232,85,100,.4) 0%, rgba(232,85,100,.25) 40%, rgba(232,85,100,.1) 60%, rgba(232,85,100,0) 80%);
      opacity:0;filter:blur(4px);
    }
    .geovisor-stage.active::before{animation:aura 1.8s ease-out forwards}
    @keyframes aura{
      0%{opacity:0;transform:translateX(-50%) scale(.65);filter:blur(4px)}
      30%{opacity:1;filter:blur(2px)}
      100%{opacity:0;transform:translateX(-50%) scale(1.1);filter:blur(6px)}
    }

    .geovisor-stage::after{
      content:"";position:absolute;top:0;left:50%;transform:translateX(-50%);
      width:100px;height:100px;pointer-events:none;z-index:1;
      background:radial-gradient(circle, rgba(255,255,255,.8) 0%, rgba(232,85,100,.5) 50%, transparent 70%);
      opacity:0;
    }
    .geovisor-stage.active::after{animation:particulas 1.5s ease-out forwards 1.8s}
    @keyframes particulas{
      0%{opacity:0;transform:translateX(-50%) scale(0)}
      20%{opacity:0.8}
      100%{opacity:0;transform:translateX(-50%) scale(2)}
    }

    .card.glow{
      box-shadow:0 16px 32px rgba(232,85,100,.5), 0 0 0 0 rgba(232,85,100,.4);
      animation:bump 0.5s ease-out, ring 1.2s ease-out 0.1s, vibrate 0.3s ease-in-out 0.5s 2
    }
    @keyframes bump{0%{transform:translateZ(0) scale(1)}40%{transform:translateZ(0) scale(1.05)}100%{transform:translateZ(0) scale(1)}}
    @keyframes ring{0%{box-shadow:0 16px 32px rgba(232,85,100,.5), 0 0 0 0 rgba(232,85,100,.4)}100%{box-shadow:0 16px 32px rgba(232,85,100,.3), 0 0 0 40px rgba(232,85,100,0)}}
    @keyframes vibrate{0%,100%{transform:translateZ(0) scale(1)}50%{transform:translateZ(0) scale(1.01) translateX(2px)}}

    .card.glow::before{
      content:"";position:absolute;top:-20px;left:50%;transform:translateX(-50%);
      width:200px;height:200px;pointer-events:none;z-index:2;
      background:radial-gradient(circle, rgba(255,255,255,.6) 0%, transparent 70%);
      opacity:0;animation:flare 0.8s ease-out forwards 1.8s
    }
    @keyframes flare{0%{opacity:0;transform:translateX(-50%) scale(0.5)}50%{opacity:0.7}100%{opacity:0;transform:translateX(-50%) scale(1.5)}}

    @media (prefers-reduced-motion:reduce){
      body, .logo, nav a, .btn, .title, .title span, .subtitle, .art img, .cover::before,
      .info-apartado, .stats, .conector .fila.superior::before, .conector .fila.superior::after,
      .conector .nodo.rama::after, .conector .fila.inferior::after, .conector .nodo.join-left::after,
      .conector .nodo.join-right::after, .geovisor-stage::before, .geovisor-stage::after,
      .card, .card::before { animation:none!important; transform:none!important; opacity:1!important }
      nav a::after{display:none}
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="site" role="banner">
    <div class="navwrap">
      <a class="logo" href="#inicio">
        <img src="https://lh3.googleusercontent.com/d/109rN8IqcM3AyWK6NRWNhouL-tqI03QXR=w1000" alt="Logo GeoVivienda">
        <span>GeoVivienda</span>
      </a>
      <nav aria-label="Principal">
        <ul>
          <li><a class="active" href="#inicio">Inicio</a></li>
          <li><a href="#geovisor">Geovisor</a></li>
          <li><a href="#vmvu">VMVU</a></li>
          <li><a href="#mvcs">VMCS</a></li>
          <li><a href="#sg">SG</a></li>
          <li><a href="#analisis">Análisis SIG</a></li>
        </ul>
      </nav>
      <div class="cta"><a class="btn" href="#ingresar">Ingresar</a></div>
    </div>
  </header>

  <!-- Carátula -->
  <section id="inicio" class="cover">
    <div class="container">
      <div>
        <h1 class="title">
          <span style="--i:1">Plataforma</span>
          <span style="--i:2">GIS</span>
          <span style="--i:3">del</span>
          <span style="--i:4">Ministerio</span>
          <span style="--i:5">de</span>
          <span style="--i:6">Vivienda,</span>
          <span style="--i:7">Construcción</span>
          <span style="--i:8">y</span>
          <span style="--i:9">Saneamiento</span>
        </h1>
        <p class="subtitle">
          Accede a datos geográficos y estadísticos actualizados sobre vivienda, agua, saneamiento,
          titulación y planificación urbana. Una herramienta del MVCS al servicio de la ciudadanía
          y los gobiernos locales.
        </p>
        <div class="actions">
          <a class="btn" href="#geovisor">Geovisor</a>
          <a class="btn ghost" href="#datos">Datos abiertos</a>
        </div>
      </div>
      <div class="art">
        <img class="floaty" src="https://lh3.googleusercontent.com/d/1yMPY_3miMHPYv6qXHp3013u3QHHf-0Ec=w1000" alt="Mapa Perú decorativo" />
      </div>
    </div>

    <!-- Texto institucional -->
    <div class="info-apartado">
      El Geovivienda, es el medio oficial para el acceso, uso e intercambio de información espacial que genera
      el <strong>Ministerio de Vivienda, Construcción y Saneamiento</strong>, aprobado mediante la R.M. Nº087-2019-VIVIENDA.
    </div>

    <!-- NUESTRAS CIFRAS -->
    <div class="stats">
      <div class="wrap">
        <h2>Nuestras Cifras</h2>
        <div class="kpis">
          <div class="counter" data-value="15333"><div class="slot" aria-label="Cobertura de Agua"></div><div class="label">Cobertura de Agua</div></div>
          <div class="kpi-sep">·</div>
          <div class="counter" data-value="14426"><div class="slot" aria-label="Proyectos Culminados"></div><div class="label">Proyectos Culminados</div></div>
          <div class="kpi-sep">·</div>
          <div class="counter" data-value="427311"><div class="slot" aria-label="Conexiones de agua nuevas"></div><div class="label">Conexiones de agua nuevas</div></div>
          <div class="kpi-sep">·</div>
          <div class="counter" data-value="157499"><div class="slot" aria-label="Conexiones de Alcantarillado"></div><div class="label">Conexiones de Alcantarillado</div></div>
        </div>
        <div class="footnote">Actualizado al 03:11 PM -05, 22/09/2025</div>
      </div>
    </div>

    <!-- RAMIFICACIÓN -->
    <div class="conector" id="ramificacion">
      <div class="fila superior">
        <div class="nodo rama">
          <img src="https://lh3.googleusercontent.com/d/1i8CwW-eOf-Pd2ANa6o7X6yaFOcP5KpC7=w1000" alt="Imagen A">
        </div>
        <div class="nodo">
          <img src="https://lh3.googleusercontent.com/d/1Ht4cpFniu4yNOJ-M3A003PSEmo89fsVk=w1000" alt="Imagen B">
        </div>
        <div class="nodo rama">
          <img src="https://lh3.googleusercontent.com/d/16PFDGwh-xesWMdmsq_SpXgwwqwUiKfBk=w1000" alt="Imagen C">
        </div>
      </div>
      <div class="fila inferior">
        <div class="nodo join-left">
          <img src="https://lh3.googleusercontent.com/d/1Yg8K4w6hDMz_EZ8n6otQNAmFIPB16xCG=w1000" alt="Imagen D">
        </div>
        <div class="nodo join-right">
          <img src="https://lh3.googleusercontent.com/d/1y0YcBuWlZGH7ulNQEzgyGqvIk9IxH34a=w1000" alt="Imagen E">
        </div>
      </div>
    </div>

    <!-- GEOVISOR -->
    <div class="wrapper">
      <div class="section geovisor-stage" id="stage">
        <h2 class="section-title">Geovisor</h2>
        <div class="cards-row cols-3">
          <div class="card" id="visor">
            <div class="card-header">
              <span>Visor Cartográfico</span>
              <div class="card-icon">
                <svg viewBox="0 0 24 24" width="24" height="24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z" fill="#fff"/></svg>
              </div>
            </div>
            <div class="card-body">
              Síntesis de brechas e intervenciones en vivienda, titulación, acceso a servicios básicos y acceso a infraestructura y equipamiento urbano.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
  /* ===== Contadores – franja "Nuestras Cifras" ===== */
  (function(){
    const SEP='.';               
    const duration=1400;
    const extraSpin=6;
    const easeOut=t=>1-Math.pow(1-t,3);

    const counters=document.querySelectorAll('.stats .counter');
    const formatES=num => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, SEP);

    function buildDigits(slot, str){
      slot.innerHTML='';
      for(const ch of str){
        if(ch===SEP){
          const s=document.createElement('span');
          s.className='sep'; s.textContent='.'; slot.appendChild(s);
        }else{
          const d=document.createElement('span');
          d.className='digit'; d.dataset.target=ch; d.textContent='0';
          slot.appendChild(d);
        }
      }
    }
    function spinDigit(el, finalDigit, idx){
      const start=performance.now();
      const spins=extraSpin+idx;
      const total=spins*10+Number(finalDigit);
      function frame(now){
        const t=Math.min(1,(now-start)/(duration+idx*100));
        const eased=easeOut(t);
        const step=Math.floor(total*eased);
        el.textContent=(step%10).toString();
        if(t<1) requestAnimationFrame(frame); else el.textContent=finalDigit;
      }
      requestAnimationFrame(frame);
    }
    function runCounter(counter){
      const val = Number(counter.dataset.value || '0');
      const slot = counter.querySelector('.slot');
      buildDigits(slot, formatES(val));
      slot.querySelectorAll('.digit').forEach(d=>d.textContent=Math.floor(Math.random()*10));
      let i=0;
      for(const node of slot.children){
        if(node.classList && node.classList.contains('digit')){ spinDigit(node, node.dataset.target, i++); }
      }
    }

    const stats=document.querySelector('.stats');
    let fired=false;
    const io=new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting && !fired){
          fired=true; counters.forEach(runCounter); io.disconnect();
        }
      });
    },{threshold:.25});
    if(stats) io.observe(stats);
  })();

  /* ===== Disparo “on view” de Ramificación + Encendido Geovisor ===== */
  (function(){
    const conector = document.getElementById('ramificacion');
    const stage = document.getElementById('stage');
    const visor = document.getElementById('visor');
    if(!conector) return;

    const io = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          // Activa animaciones de líneas
          conector.classList.add('is-inview');

          // Un poco después, activa el aura/partículas y el glow del visor
          setTimeout(()=>{
            stage.classList.add('active');
            visor.classList.add('glow');
            setTimeout(()=> visor.classList.remove('glow'), 2000);
          }, 1800); // ajusta si quieres más/menos delay desde que empiezan las líneas

          io.disconnect();
        }
      });
    }, {threshold: 0.4}); // ~40% visible
    io.observe(conector);
  })();
  </script>
</body>
</html>
