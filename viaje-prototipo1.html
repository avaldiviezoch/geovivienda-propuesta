<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EUROTRIP 2025 ¬∑ Itinerario + Tips</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<meta name="color-scheme" content="light dark"/>
<style>
  :root{
    --bg:#080e1a; --ink:#e9f2ff; --muted:#a8b4cc;
    --glass: color-mix(in srgb, #ffffff 12%, transparent);
    --card: color-mix(in srgb, #ffffff 8%, transparent);
    --stroke: color-mix(in srgb, #99b1ff 20%, transparent);
    --brand:#6b8cff; --brand2:#a66bff;
    --ok:#34d399; --warn:#f59e0b; --danger:#f87171;
    --radius:12px; --maxw:1100px; --hdr:88px;
    --shadow:0 8px 24px rgba(0,0,0,.4);
    --bg-grad1: radial-gradient(1000px 1000px at 5% -5%, #162040 0, transparent 65%);
    --bg-grad2: radial-gradient(1000px 1000px at 105% 15%, #2e1a45 0, transparent 60%);
    --green:#16a34a; --blue:#0ea5e9;
  }
  :root[data-theme="light"]{
    --bg:#f5f7ff; --ink:#0a1120; --muted:#5a6688;
    --glass: color-mix(in srgb, #000 8%, transparent);
    --card:#ffffffe6; --stroke:#d0d9ff;
    --brand:#2563eb; --brand2:#9333ea;
    --shadow:0 8px 24px rgba(0,0,0,.1);
    --bg-grad1: radial-gradient(1000px 1000px at 5% -5%, #e0e7ff 0, transparent 65%);
    --bg-grad2: radial-gradient(1000px 1000px at 105% 15%, #ede4ff 0, transparent 60%);
    --green:#22c55e; --blue:#2ea7ff;
  }

  *{box-sizing:border-box}
  html,body{
    margin:0;height:100%;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    background: var(--bg-grad1), var(--bg-grad2), var(--bg);
    color:var(--ink);overflow-x:hidden
  }
  a{color:var(--brand);text-decoration:none}
  a:hover{text-decoration:underline}
  button{font:inherit;cursor:pointer}

  /* COVER */
  .cover{
    width:min(100% - 24px, var(--maxw));
    margin:40px auto 20px;text-align:center;display:grid;gap:18px;
    padding:30px 0 18px;background:radial-gradient(circle at 50% 50%, rgba(0,0,0,.25), var(--bg) 70%);
  }
  .cover__title{font-size:40px;font-weight:900;letter-spacing:1.2px;margin:0;color:var(--ink);text-shadow:0 4px 12px rgba(0,0,0,.3)}

  .hero-box{position:relative;height:160px;display:grid;place-items:center;overflow:hidden}
  .cover__faces{position:absolute; inset:0;display:flex;justify-content:center;align-items:flex-end;gap:28px;filter: drop-shadow(0 8px 20px rgba(0,0,0,.45))}
  .cover__head{width:120px;height:120px;object-fit:contain;transform-origin: bottom center;animation: neck-tilt 3.5s ease-in-out infinite}
  .cover__head--lag{ animation-delay:1s }
  @keyframes neck-tilt{0%{transform:rotate(0)}25%{transform:rotate(8deg)}50%{transform:rotate(0)}75%{transform:rotate(-8deg)}100%{transform:rotate(0)}}
  .cover__car{position:absolute; inset:0; display:grid; place-items:center; pointer-events:none}
  .car-img{max-width:92%; max-height:120px; height:auto; width:auto;filter:drop-shadow(0 16px 24px rgba(0,0,0,.45));animation: car-bob 1.6s ease-in-out infinite, car-sway 2.6s ease-in-out infinite}
  @keyframes car-bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
  @keyframes car-sway{0%,100%{transform:rotate(-1.5deg)}50%{transform:rotate(1.5deg)}}
  .car-shadow{position:absolute; bottom:6px; left:50%; transform:translateX(-50%);width:44%; height:14px; background:radial-gradient(ellipse, rgba(0,0,0,.35), rgba(0,0,0,0) 70%);filter:blur(3px); animation: squash 1.6s ease-in-out infinite}
  @keyframes squash{0%,100%{transform:translateX(-50%) scaleX(1)}50%{transform:translateX(-50%) scaleX(1.08)}}
  .speedlines{position:absolute; inset:0; overflow:hidden}
  .line{position:absolute; right:-10%; width:18%; height:2px;background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.75), rgba(255,255,255,0));filter:blur(.6px); animation: fly 1.2s linear infinite}
  .line:nth-child(1){top:20%}.line:nth-child(2){top:38%}.line:nth-child(3){top:58%}.line:nth-child(4){top:78%}
  @keyframes fly{0%{transform:translateX(0)}100%{transform:translateX(-120vw)}}

  /* HEADER */
  .hdr{position:sticky;top:0;z-index:60;height:var(--hdr);display:flex;align-items:center;justify-content:center;backdrop-filter: blur(12px);background:linear-gradient(180deg, color-mix(in srgb, var(--bg) 75%, transparent), color-mix(in srgb, var(--bg) 25%, transparent));border-bottom:1px solid var(--stroke)}
  .hdr__in{width:min(100% - 24px, var(--maxw));display:flex;align-items:center;justify-content:flex-end;gap:12px}
  .segmented{width:min(100% - 24px, 600px); margin:0 auto;position:relative; display:flex; gap:0; padding:4px;border:1px solid var(--stroke); border-radius:999px;background:color-mix(in srgb, var(--card) 70%, transparent);box-shadow:inset 0 1px 0 rgba(255,255,255,.06);overflow:auto; scrollbar-width:none}
  .segmented::-webkit-scrollbar{display:none}
  .seg{position:relative; z-index:1; flex:1 1 auto; white-space:nowrap;padding:8px 16px; border:0; background:transparent; color:var(--muted);font-weight:800; border-radius:999px; transition:color .2s ease;font-size:15px}
  @media (max-width:420px){.seg{font-size:13px; padding:8px 12px}.cover__head{width:100px;height:100px}.hero-box{height:140px}.car-img{max-height:100px}}
  .seg[aria-selected="true"]{ color:#081123 }
  :root[data-theme="dark"] .seg[aria-selected="true"]{ color:#061022 }
  .thumb{position:absolute; z-index:0; top:4px; left:4px; height:calc(100% - 8px);width:120px; border-radius:999px;background:linear-gradient(180deg, #fff, color-mix(in srgb,#fff 45%, transparent));box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.65);transition:left .22s cubic-bezier(.22,.9,.2,1), width .22s cubic-bezier(.22,.9,.2,1)}
  :root[data-theme="dark"] .thumb{background:linear-gradient(180deg, #eaf1ff, color-mix(in srgb,#eaf1ff 70%, transparent))}
  .hdr__actions{display:flex;gap:8px;flex-wrap:wrap}
  .btn{height:40px;padding:0 14px;border:1px solid var(--stroke);border-radius:10px;color:var(--ink);background:linear-gradient(180deg, color-mix(in srgb, var(--card) 65%, transparent), transparent);transition:all .2s ease;min-width:120px}
  .btn:hover{border-color:color-mix(in srgb, var(--brand) 50%, var(--stroke));background:color-mix(in srgb, var(--brand) 15%, var(--card))}
  .btn--ghost{border:1px solid var(--stroke);background:transparent}
  @media (max-width:560px){.hdr{--hdr:auto;padding:10px 0}.hdr__in{flex-direction:column;gap:12px;align-items:stretch}.hdr__actions{width:100%;justify-content:center}.btn{width:100%}}

  /* Top cards */
  .top{width:min(100% - 24px, var(--maxw));margin:16px auto;display:grid;gap:12px}
  .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;box-shadow:var(--shadow);position:relative;overflow:hidden}
  .card::after{content:"";position:absolute;inset:-15%;background:
    radial-gradient(500px 180px at 0% 0%, color-mix(in srgb, var(--brand) 15%, transparent), transparent 65%),
    radial-gradient(700px 220px at 100% -15%, color-mix(in srgb, var(--brand2) 15%, transparent), transparent 65%);pointer-events:none;opacity:0.7}
  .filters{padding:12px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
  .tag{padding:8px 14px;border-radius:999px;border:1px solid var(--stroke);background:color-mix(in srgb, var(--glass) 75%, transparent);font-weight:600;font-size:13px;transition:all .2s ease}
  .tag:hover{background:linear-gradient(90deg, color-mix(in srgb, var(--brand) 20%, var(--glass)), color-mix(in srgb, var(--brand2) 20%, var(--glass)));border-color:color-mix(in srgb, var(--brand) 40%, var(--stroke));transform:scale(1.05)}
  .tag.active{background:linear-gradient(90deg, var(--brand), var(--brand2));border:none;color:#fff;transform:scale(1.02)}
  .summary{padding:16px;display:grid;gap:12px}
  .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  @media (max-width:680px){.kpis{grid-template-columns:repeat(2,1fr)}}
  .kpi{padding:10px;border:1px dashed var(--stroke);border-radius:10px;display:grid;gap:5px;background:color-mix(in srgb, var(--glass) 60%, transparent)}
  .kpi b{font-size:18px}

  /* ===== ITINERARIO ===== */
  .days{width:min(100% - 24px, var(--maxw));margin:10px auto 50px;display:grid;gap:10px}
  .day{border:1px solid var(--stroke);border-radius:12px;background:color-mix(in srgb, #0c1528 70%, transparent);overflow:hidden;transition:box-shadow .3s ease, transform .2s ease}
  .day:hover{box-shadow:0 6px 20px rgba(0,0,0,.25);transform:translateY(-2px)}
  :root[data-theme="light"] .day{background:#ffffffe6}
  .day__hdr{display:flex;align-items:center;gap:8px;padding:10px 12px;background:color-mix(in srgb, var(--glass) 70%, transparent);border-bottom:1px solid var(--stroke)}
  .date{font-weight:900;letter-spacing:.2px;font-size:15px}
  .city{color:var(--muted);font-size:13px;margin-left:auto}
  .state{font-size:11px;padding:5px 9px;border-radius:8px;border:1px solid var(--stroke);font-weight:600}
  .state.ok{color:#aaffc7;border-color:var(--ok)} .state.pend{color:#ffe2a6;border-color:var(--warn)} .state.fly{color:#ffcad2;border-color:var(--danger)}
  .events{display:grid;gap:8px;padding:10px}
  .ev{display:grid;gap:8px;padding:10px;border:1px solid var(--stroke);border-radius:10px;background:color-mix(in srgb, var(--glass) 60%, transparent);transition:transform .25s ease,border-color .25s ease,box-shadow .25s ease}
  .ev:hover{transform:translateY(-2px) scale(1.005);border-color:color-mix(in srgb, var(--brand) 50%, var(--stroke));box-shadow:0 6px 20px rgba(35,76,184,.2)}
  .ev__row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .ev h4{margin:0;font-size:14px;display:flex;align-items:center;gap:6px}
  .pill{height:24px;display:inline-flex;align-items:center;gap:5px;padding:0 9px;border-radius:999px;font-size:11px;border:1px solid var(--stroke);color:var(--muted);background:color-mix(in srgb, var(--glass) 60%, transparent)}
  .pill.ok{border-color:color-mix(in srgb, var(--ok) 60%, var(--stroke))} .pill.pend{border-color:color-mix(in srgb, var(--warn) 60%, var(--stroke))} .pill.fly{border-color:color-mix(in srgb, var(--danger) 60%, var(--stroke))}
  .when{color:#2b7fff} .where{color:#7f63ff}
  .act{margin-left:auto;display:flex;gap:5px;flex-wrap:wrap}
  .btn-mini{height:26px;padding:0 7px;border-radius:8px;border:1px solid var(--stroke);background:color-mix(in srgb, var(--glass) 55%, transparent);color:var(--ink);font-size:11px;transition:all .2s ease}
  .btn-mini:hover{background:color-mix(in srgb, var(--brand) 25%, transparent);border-color:var(--brand);transform:scale(1.03)}
  .mini-map{font-size:10px;opacity:.85}
  .icon{width:20px;height:20px;display:inline-grid;place-items:center;border-radius:6px;background:linear-gradient(180deg, color-mix(in srgb, var(--brand) 25%, transparent), color-mix(in srgb, var(--brand2) 15%, transparent));border:1px solid color-mix(in srgb, var(--stroke) 85%, transparent);box-shadow:inset 0 0 8px rgba(255,255,255,.15)}
  .ico{font-size:13px;filter:drop-shadow(0 1px 4px rgba(0,0,0,.3))}
  .muted{color:var(--muted)}

  /* ===== RECORRIDO (l√≠nea + nodos) ===== */
  :root{ --railW:3px; --center:36px; --gap:16px; --rowGap:14px }
  .r-days{width:min(100% - 24px, var(--maxw)); margin:16px auto 40px; display:grid; gap:8px}
  .r-day{position:relative; padding:8px 0}
  .r-day-line{position:absolute; inset:0 auto 0 0; width:var(--railW); border-radius:6px; opacity:.95; z-index:0;
    left:calc(140px + var(--gap) + (var(--center)/2) - (var(--railW)/2));
    background:var(--green); box-shadow:0 0 6px color-mix(in srgb,var(--green) 70%,transparent); pointer-events:none}
  @media(max-width:540px){ .r-day-line{left:calc(120px + var(--gap) + (var(--center)/2) - (var(--railW)/2))} }
  .r-day.open .r-day-line{opacity:0}
  .r-hdr{display:grid;grid-template-columns:140px var(--center) 1fr;column-gap:var(--gap);align-items:center;cursor:pointer;user-select:none;position:relative;z-index:1}
  @media(max-width:540px){.r-hdr{grid-template-columns:120px var(--center) 1fr}}
  .r-date{display:flex;flex-direction:column;gap:2px;color:var(--green);font-weight:900;font-size:13px}
  .r-date .r-meta{font-size:11px;font-weight:700;color:color-mix(in srgb,var(--green) 85%,var(--muted))}
  .r-center{display:grid;place-items:center}
  .r-dot{width:22px;height:22px;border-radius:50%;background:var(--green);display:grid;place-items:center;color:#fff;box-shadow:0 0 0 3px color-mix(in srgb,var(--green) 30%,transparent);font-weight:900;font-size:12px}
  .r-city{font-weight:900;font-size:16px;white-space:nowrap}
  .r-chev{margin-left:8px;transition:transform .25s ease}
  .r-day.open .r-chev{transform:rotate(180deg)}
  .r-panel{display:none}
  .r-day.open .r-panel{display:block}
  .r-events{position:relative;padding:6px 0;margin-top:2px}
  .r-row{display:grid;grid-template-columns:140px var(--center) 1fr;column-gap:var(--gap);align-items:start;margin-bottom:var(--rowGap)}
  @media(max-width:540px){.r-row{grid-template-columns:120px var(--center) 1fr}}
  .r-time{font-weight:900;font-size:12px;color:var(--blue);white-space:nowrap}
  .r-anchor{height:0;align-self:center}
  .r-title{font-weight:800;font-size:15px;line-height:1.25}
  .r-desc{font-size:12px;color:var(--muted);margin-top:2px}
  .r-chip{display:inline-grid;place-items:center;height:18px;padding:0 8px;font-size:10.5px;border-radius:999px;margin-left:8px;border:1px solid color-mix(in srgb,#9db6ff 55%,transparent);color:var(--ink);opacity:.9}

  .r-rail{position:absolute;inset:0;pointer-events:none}
  .r-seg{position:absolute;z-index:0;width:var(--railW);border-radius:4px;left:calc(140px + var(--gap) + (var(--center)/2) - (var(--railW)/2));background:linear-gradient(180deg,var(--blue),color-mix(in srgb,var(--blue) 35%,transparent))}
  .r-seg--green{background:var(--green)}
  .r-node{position:absolute;z-index:2;width:22px;height:22px;border-radius:50%;display:grid;place-items:center;color:#fff;left:calc(140px + var(--gap) + (var(--center)/2) - 11px);font-size:11px;line-height:1;box-shadow:0 0 0 3px color-mix(in srgb,var(--green) 25%,transparent);background:var(--blue)}
  .r-node--green{background:var(--green)}
  .r-label{position:absolute;left:calc(140px + var(--gap) + (var(--center)) + 8px);transform:translateY(-50%);font-size:11px;color:var(--blue);opacity:.9;white-space:nowrap}
  @media(max-width:540px){
    .r-seg{left:calc(120px + var(--gap) + (var(--center)/2) - (var(--railW)/2))}
    .r-node{left:calc(120px + var(--gap) + (var(--center)/2) - 11px)}
    .r-label{left:calc(120px + var(--gap) + (var(--center)) + 8px)}
  }

  /* Views */
  .views{width:100%}
  .view{display:none}
  .view.active{display:block}

  /* ===== RUTA (MAPA) ===== */
  .route-wrap{width:min(100% - 24px, var(--maxw)); margin:16px auto 46px; display:grid; gap:12px}
  .route-title{margin:0 4px; font-weight:900; letter-spacing:.3px}
  .hiker-wrap{display:grid;place-items:center}
  .hiker{
    width:min(200px,42vw); height:auto;
    filter:drop-shadow(0 16px 28px rgba(0,0,0,.45));
    animation: bob 2.4s ease-in-out infinite, sway 3.8s ease-in-out infinite;
    transform-origin: 50% 100%;
  }
  @keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
  @keyframes sway{0%,100%{transform:rotate(-1.6deg)}50%{transform:rotate(1.6deg)}}

  .route-filter{background:var(--card);border:1px solid var(--stroke);border-radius:14px;overflow:hidden}
  .route-filter summary{list-style:none;cursor:pointer;padding:12px 14px;font-weight:900;display:flex;align-items:center;gap:10px}
  .route-filter summary::-webkit-details-marker{display:none}
  .chev{width:16px;height:16px;flex:0 0 16px;opacity:.9;animation:nudge 1.3s ease-in-out infinite;transform-origin:50% 50%}
  @keyframes nudge{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
  details[open] .chev{animation:none;transform:rotate(180deg)}
  .route-filter .muted{color:var(--muted);font-weight:700;font-size:13px;margin-left:auto}
  .route-list{padding:6px 10px;border-top:1px solid var(--stroke);display:grid;gap:6px}
  .route-item{display:flex;align-items:center;gap:12px;padding:10px;border:1px solid var(--stroke);border-radius:10px;background:color-mix(in srgb, var(--glass) 60%, transparent);cursor:pointer}
  .route-item:hover{border-color:#3b82f660;background:color-mix(in srgb, var(--glass) 75%, transparent)}
  .icoDay{width:30px;height:30px;border-radius:10px;display:grid;place-items:center;background:color-mix(in srgb, var(--brand) 20%, transparent);border:1px solid var(--stroke);font-size:16px}
  .dateTag{font-weight:900;color:#86efac;background:#052d22;border:1px solid #105f49;border-radius:8px;padding:2px 8px;font-size:12px}
  .hint{color:#c7d2fe;font-weight:800}
  .sub{color:var(--muted);font-size:12px}
  .count{margin-left:auto;font-weight:900;color:#93c5fd;background:#0a254a;border:1px solid #214a8a;border-radius:8px;padding:2px 8px;font-size:12px}

  #map{height:73vh;width:100%;border:1px solid var(--stroke);border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.35);position:relative;overflow:hidden}
  .controls{position:absolute; right:12px; top:12px; z-index:500; display:grid; gap:8px}
  .btn-float{
    border:1px solid var(--stroke); background:color-mix(in srgb, var(--card) 70%, transparent); color:var(--ink);
    padding:8px 10px; border-radius:10px; font-weight:800; cursor:pointer; backdrop-filter: blur(6px);
  }
  .btn-float:hover{background:color-mix(in srgb, var(--brand) 10%, var(--card));border-color:color-mix(in srgb, var(--brand) 40%, var(--stroke))}
  .num{background:#1f49ff; color:#fff; border:2px solid #fff; border-radius:999px; width:26px; height:26px; display:grid; place-items:center; font-weight:900; font-size:12px; box-shadow:0 2px 10px rgba(0,0,0,.35)}

  /* ===== TIPS ===== */
  .tips{width:min(100% - 24px, var(--maxw)); margin:16px auto 46px; display:grid; gap:16px}
  .tips-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
  @media(max-width:800px){ .tips-grid{grid-template-columns:1fr} }
  .tip-card{padding:14px;border:1px solid var(--stroke);border-radius:12px;background:color-mix(in srgb, var(--glass) 65%, transparent);display:grid;gap:8px}
  .tip-card h4{margin:0;font-size:16px}
  .tip-card ul{margin:0 0 0 18px; padding:0; display:grid; gap:6px}
  .tip-card li{line-height:1.35}

  .accordion{background:var(--card);border:1px solid var(--stroke);border-radius:12px;overflow:hidden}
  .accordion details+details{border-top:1px solid var(--stroke)}
  .accordion summary{list-style:none;cursor:pointer;padding:12px 14px;font-weight:900;display:flex;align-items:center;gap:10px}
  .accordion summary::-webkit-details-marker{display:none}
  .accordion .inner{padding:10px 14px 14px 14px; color:var(--muted)}
  .tip-list{display:grid; gap:10px}
  .tip-item{display:grid; grid-template-columns:36px 1fr auto; gap:10px; align-items:center; padding:10px; border:1px solid var(--stroke); border-radius:12px; background:color-mix(in srgb, var(--glass) 60%, transparent)}
  .tip-ico{width:36px; height:36px; border-radius:10px; display:grid; place-items:center; font-size:18px; background:color-mix(in srgb, var(--brand) 20%, transparent); border:1px solid var(--stroke)}
  .tip-title{font-weight:800}
  .tip-sub{font-size:12px; color:var(--muted)}
  .tip-badge{font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--stroke); background:color-mix(in srgb, var(--glass) 60%, transparent)}

  @media print{
    .hdr, .filters, .hdr__actions, .segmented{display:none !important}
    body{background:#fff;color:#111}
    .card, .day{box-shadow:none;border:1px solid #ddd}
    .day__hdr{background:#f6f8ff;-webkit-print-color-adjust:exact;print-color-adjust:exact}
    a{color:#000;text-decoration:none}
  }
</style>
</head>
<body>

<section class="cover">
  <h1 class="cover__title">EUROTRIP 2025 ¬∑ Itinerario + Tips</h1>

  <div class="hero-box" id="heroBox">
    <div class="cover__faces" id="hero-heads" aria-hidden="false">
      <img class="cover__head" src="https://lh3.googleusercontent.com/d/1E82o__-jHJmWwubokZcy2WgMVBXha4LO=w1000" alt="Antonio">
      <img class="cover__head cover__head--lag" src="https://lh3.googleusercontent.com/d/1GfkwGMzG9RTNaMLWdUxzxkvdTBWmFIxA=w1000" alt="Pareja">
    </div>
    <div class="cover__car" id="hero-car" aria-hidden="true" style="display:none">
      <div class="speedlines"><span class="line"></span><span class="line"></span><span class="line"></span><span class="line"></span></div>
      <img class="car-img" src="https://lh3.googleusercontent.com/d/1b06CeZcjsV4qlKcHyQoV9dtceRli9Zsg=w1000" alt="Auto en movimiento">
      <div class="car-shadow"></div>
    </div>
  </div>

  <!-- PESTA√ëAS -->
  <nav class="segmented" id="segmented">
    <div class="thumb" id="thumb"></div>
    <button class="seg" aria-selected="true"  data-tab="itinerario">Itinerario</button>
    <button class="seg" aria-selected="false" data-tab="recorrido">Recorrido</button>
    <button class="seg" aria-selected="false" data-tab="ruta">Ruta</button>
    <button class="seg" aria-selected="false" data-tab="tips">Tips</button>
  </nav>
</section>

<header class="hdr">
  <div class="hdr__in">
    <div class="hdr__actions">
      <button class="btn" id="btnTheme">üåô/‚òÄÔ∏è Tema</button>
      <button class="btn btn--ghost" id="btnPrint">üñ®Ô∏è PDF</button>
    </div>
  </div>
</header>

<div class="views">

  <!-- ===== ITINERARIO ===== -->
  <section id="view-itinerario" class="view active">
    <section class="top">
      <div class="card">
        <div class="filters" id="filters">
          <button class="tag active" data-filter="all">üîé Todos</button>
          <button class="tag" data-filter="Madrid">üèôÔ∏è Madrid</button>
          <button class="tag" data-filter="Par√≠s">üóº Par√≠s</button>
          <button class="tag" data-filter="Versalles">üëë Versalles</button>
          <button class="tag" data-filter="Vuelo">‚úàÔ∏è Vuelos</button>
          <button class="tag" data-filter="Confirmado">‚úÖ Confirmado</button>
          <button class="tag" data-filter="Pendiente">‚è≥ Pendiente</button>
          <button class="tag" data-filter="Museo">üñºÔ∏è Museos</button>
          <button class="tag" data-filter="Crucero">üö§ Crucero</button>
          <button class="tag" data-filter="Parque">üé¢ Parque</button>
          <button class="tag" data-filter="Paseo">üö∂ Paseo</button>
          <button class="tag" data-filter="Tour">üèüÔ∏è Tour</button>
          <button class="tag" data-filter="Monumento">üèõÔ∏è Monumento</button>
          <button class="tag" data-filter="Cultura">üìö Cultura</button>
          <button class="tag" data-filter="Info">‚ÑπÔ∏è Info</button>
        </div>
      </div>

      <div class="card summary reveal">
        <div class="row">
          <div>
            <div style="opacity:.9;font-weight:900;letter-spacing:.3px">Itinerario actualizado ‚Äî EUROTRIP 2025</div>
            <div class="muted" style="font-size:13px">Fechas: <b>6‚Äì17 nov 2025</b> ¬∑ Rutas: <b>Lima ¬∑ Madrid ¬∑ Par√≠s ¬∑ Madrid ¬∑ Lima</b></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span class="kpi" style="display:inline-grid;min-width:160px"><span class="muted" style="font-size:12px">Entradas confirmadas</span><b>6</b></span>
            <span class="kpi" style="display:inline-grid;min-width:160px"><span class="muted" style="font-size:12px">Pendientes</span><b>2</b></span>
          </div>
        </div>
        <div class="kpis">
          <div class="kpi"><span class="muted" style="font-size:12px">D√≠as totales</span><b>12</b></div>
          <div class="kpi"><span class="muted" style="font-size:12px">Ciudades</span><b>Madrid ¬∑ Par√≠s ¬∑ Toledo</b></div>
          <div class="kpi"><span class="muted" style="font-size:12px">Vuelos planificados</span><b>3</b></div>
        </div>
      </div>
    </section>

    <main class="days" id="days"></main>

    <section class="tools">
      <div class="card panel reveal">
        <h3>Notas personales (guardadas en este navegador)</h3>
        <textarea id="notes" placeholder="Escribe ideas, presupuestos, recordatorios‚Ä¶"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="saveNotes">üíæ Guardar</button>
        </div>
      </div>
      <div class="card panel reveal">
        <h3>Checklist de entradas / tareas</h3>
        <div class="checklist" id="checklist"></div>
      </div>
    </section>
  </section>

  <!-- ===== RECORRIDO ===== -->
  <section id="view-recorrido" class="view">
    <div class="r-days" id="r-days"></div>
  </section>

  <!-- ===== RUTA (MAPA) ===== -->
  <section id="view-ruta" class="view">
    <div class="route-wrap">
      <h3 class="route-title">Ruta diaria</h3>

      <div class="hiker-wrap">
        <img class="hiker" src="https://lh3.googleusercontent.com/d/11y4gVmkbWpGCjElxOLphi0gtHG1WCQpG=w1000" alt="Viajera">
      </div>

      <details class="route-filter" id="dayFilter">
        <summary>
          <svg class="chev" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6z"/>
          </svg>
          Selecciona tu d√≠a
          <span class="muted" id="currentLabel">‚Äî</span>
        </summary>
        <div class="route-list" id="dayList"></div>
      </details>

      <div id="map"></div>
    </div>
  </section>

  <!-- ===== TIPS ===== -->
  <section id="view-tips" class="view">
    <div class="tips">
      <div class="tips-grid">
        <div class="tip-card">
          <h4>üßæ Transporte y apps √∫tiles</h4>
          <ul>
            <li><b>Navigo Easy Pass (Par√≠s):</b> recargable en m√°quinas RATP o quioscos; cubre metro + RER + bus.</li>
            <li><b>Apps:</b> Google Maps / Citymapper (rutas y transporte), Bonjour RATP (metro y RER), Omio / SNCF Connect (trenes), Bolt / Free Now (taxis/VTC), Disneyland Paris App, Versailles App.</li>
          </ul>
        </div>
        <div class="tip-card">
          <h4>üíº Consejos pr√°cticos</h4>
          <ul>
            <li>Power bank ‚â• 10 000 mAh, adaptador tipo C europeo, cargadores USB m√∫ltiples.</li>
            <li>Cambiar 50‚Äì100 ‚Ç¨ en efectivo por d√≠a (uso ligero).</li>
            <li>Guardar PDFs/QR en el tel√©fono y en Drive.</li>
            <li>Revisar horarios de RER/Metro al volver tarde desde Disney o Trocad√©ro.</li>
            <li>Usar tarjeta de viaje internacional (BCP Signature/Black ‚Üí sin comisi√≥n Priority Pass).</li>
          </ul>
        </div>
      </div>

      <div class="accordion card">
        <details>
          <summary>üõçÔ∏è Compras recomendadas</summary>
          <div class="inner tip-list">
            <!-- Madrid -->
            <div class="tip-item">
              <div class="tip-ico">üõí</div>
              <div>
                <div class="tip-title">Primark Gran V√≠a 32</div>
                <div class="tip-sub">Madrid ¬∑ ropa econ√≥mica</div>
              </div>
              <div class="tip-badge">9:00‚Äì22:00</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üéÅ</div>
              <div>
                <div class="tip-title">El Corte Ingl√©s Callao</div>
                <div class="tip-sub">Madrid ¬∑ regalos y electr√≥nica</div>
              </div>
              <div class="tip-badge">Centro</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üç´</div>
              <div>
                <div class="tip-title">Oguis ‚Äî Mercado San Leopoldo</div>
                <div class="tip-sub">Madrid ¬∑ productos gourmet</div>
              </div>
              <div class="tip-badge">Gourmet</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üíÑ</div>
              <div>
                <div class="tip-title">Kiko Milano / Sephora Gran V√≠a</div>
                <div class="tip-sub">Madrid ¬∑ skincare y maquillaje</div>
              </div>
              <div class="tip-badge">Gran V√≠a</div>
            </div>
            <!-- Par√≠s -->
            <div class="tip-item">
              <div class="tip-ico">üéå</div>
              <div>
                <div class="tip-title">Royal Souvenirs ‚Äî 5 Rue Lagrange</div>
                <div class="tip-sub">Par√≠s ¬∑ souvenirs t√≠picos y aut√©nticos</div>
              </div>
              <div class="tip-badge">Latino</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üëú</div>
              <div>
                <div class="tip-title">Galeries Lafayette / Printemps</div>
                <div class="tip-sub">Par√≠s ¬∑ moda y cosm√©tica</div>
              </div>
              <div class="tip-badge">Haussmann</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üíä</div>
              <div>
                <div class="tip-title">CityPharma (Saint‚ÄëGermain‚Äëdes‚ÄëPr√©s)</div>
                <div class="tip-sub">Par√≠s ¬∑ skincare franc√©s econ√≥mico</div>
              </div>
              <div class="tip-badge">Farmacia</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üìÄ</div>
              <div>
                <div class="tip-title">FNAC Champs‚Äë√âlys√©es</div>
                <div class="tip-sub">Par√≠s ¬∑ tecnolog√≠a y accesorios</div>
              </div>
              <div class="tip-badge">Tech</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üçè</div>
              <div>
                <div class="tip-title">Apple Store Op√©ra</div>
                <div class="tip-sub">Par√≠s ¬∑ cables, power banks, adaptadores C</div>
              </div>
              <div class="tip-badge">Op√©ra</div>
            </div>
          </div>
        </details>
        <details>
          <summary>üçΩÔ∏è Restaurantes y bares</summary>
          <div class="inner tip-list">
            <!-- Madrid -->
            <div class="tip-item">
              <div class="tip-ico">üçΩÔ∏è</div>
              <div>
                <div class="tip-title">Restaurante Puerto Rico</div>
                <div class="tip-sub">C. Chinchilla 2 ¬∑ comida casera</div>
              </div>
              <div class="tip-badge">Madrid</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üç∫</div>
              <div>
                <div class="tip-title">Bar Padrao</div>
                <div class="tip-sub">Trv. de la Parada 4 ¬∑ tapas</div>
              </div>
              <div class="tip-badge">Madrid</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üçª</div>
              <div>
                <div class="tip-title">Cervecer√≠a Sierra Bar de Tapas</div>
                <div class="tip-sub">C. Galileo 41 ¬∑ raciones</div>
              </div>
              <div class="tip-badge">Madrid</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">ü•ò</div>
              <div>
                <div class="tip-title">La Petisquer√≠a</div>
                <div class="tip-sub">C. Mej√≠a Lequerica 17 ¬∑ tapas</div>
              </div>
              <div class="tip-badge">Madrid</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üç∑</div>
              <div>
                <div class="tip-title">Bar Restaurante El Duero</div>
                <div class="tip-sub">C. Noviciado 2 ¬∑ cocina castellana</div>
              </div>
              <div class="tip-badge">Madrid</div>
            </div>
            <!-- Par√≠s -->
            <div class="tip-item">
              <div class="tip-ico">ü•ñ</div>
              <div>
                <div class="tip-title">La Petite Hostellerie</div>
                <div class="tip-sub">35 Rue de la Harpe ¬∑ franc√©s tradicional</div>
              </div>
              <div class="tip-badge">Par√≠s</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">üç≤</div>
              <div>
                <div class="tip-title">Bouillon Chartier Montparnasse</div>
                <div class="tip-sub">Bistr√≥ econ√≥mico cl√°sico</div>
              </div>
              <div class="tip-badge">Par√≠s</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">‚òï</div>
              <div>
                <div class="tip-title">Brasserie Lipp / Caf√© de Flore</div>
                <div class="tip-sub">Ambiente parisino aut√©ntico</div>
              </div>
              <div class="tip-badge">Saint‚ÄëGermain</div>
            </div>
            <div class="tip-item">
              <div class="tip-ico">ü•û</div>
              <div>
                <div class="tip-title">Cr√™perie Saint‚ÄëMichel</div>
                <div class="tip-sub">Dulce o salada ¬∑ Barrio Latino</div>
              </div>
              <div class="tip-badge">Par√≠s</div>
            </div>
          </div>
        </details>
      </div>
    </div>
  </section>

</div>

<script>
/* ============ Tema ============ */
(function(){ const saved=localStorage.getItem("trip.theme"); if(saved){ document.documentElement.setAttribute('data-theme', saved); }})();
document.getElementById('btnTheme').addEventListener('click',()=>{
  const cur=document.documentElement.getAttribute('data-theme')||'dark';
  const next= cur==='light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('trip.theme', next);
});
document.getElementById('btnPrint').addEventListener('click',()=>window.print());

/* √çconos */
const ICONS={"Vuelo":"‚úàÔ∏è","Tour":"üèüÔ∏è","Museo":"üñºÔ∏è","Monumento":"üèõÔ∏è","Paseo":"üö∂","Parque":"üé¢","Crucero":"üö§","Cultura":"üìö","Info":"‚ÑπÔ∏è"};

/* ===== Datos (actualizados) ===== */
const DAYS=[
  {date:"Jue ¬∑ 6 nov 2025",city:"Vuelo",state:"Confirmado",items:[
    {title:"Vuelo Lima ‚Üí Madrid",when:"23:05 (6 nov) ‚Üí 18:30 (7 nov)",where:"LIM ‚Üí MAD (Barajas)",type:"Vuelo",state:"Confirmado",startISO:"2025-11-06T23:05:00",endISO:"2025-11-07T18:30:00",tz:"Europe/Madrid",details:"Noche en vuelo.",links:[]}
  ]},
  {date:"Vie ¬∑ 7 nov 2025",city:"Madrid",state:"Info",items:[
    {title:"Llegada y traslado al alojamiento",when:"Tarde",where:"Gran V√≠a / Chamber√≠",type:"Info",state:"Confirmado",startISO:"2025-11-07T19:30:00",endISO:"2025-11-07T21:00:00",tz:"Europe/Madrid",details:"Paseo ligero por el barrio, descanso por jet lag. Opcional cena: Restaurante Puerto Rico (C. de Chinchilla 2).",links:[{label:"Mapa",url:"https://maps.google.com/?q=Gran+V%C3%ADa+Madrid"}]}
  ]},
  {date:"S√°b ¬∑ 8 nov 2025",city:"Madrid",state:"Confirmado",items:[
    {title:"Tour Santiago Bernab√©u",when:"11:30‚Äì13:45",where:"Estadio Santiago Bernab√©u",type:"Tour",state:"Confirmado",startISO:"2025-11-08T11:30:00",endISO:"2025-11-08T13:45:00",tz:"Europe/Madrid",details:"Entrada confirmada.",links:[{label:"C√≥mo llegar",url:"https://maps.google.com/?q=Estadio+Santiago+Bernab%C3%A9u"}]},
    {title:"Centro hist√≥rico",when:"Tarde",where:"Plaza Mayor ¬∑ Puerta del Sol ¬∑ Mercado San Miguel",type:"Paseo",state:"Info",startISO:"2025-11-08T16:00:00",endISO:"2025-11-08T19:00:00",tz:"Europe/Madrid",details:"Noche: tapas en Bar Padrao o Cervecer√≠a Sierra.",links:[]}
  ]},
  {date:"Dom ¬∑ 9 nov 2025",city:"Madrid",state:"Pendiente",items:[
    {title:"Ma√±ana libre (opci√≥n A)",when:"Ma√±ana",where:"Centro Madrid",type:"Paseo",state:"Info",startISO:"2025-11-09T09:00:00",endISO:"2025-11-09T11:30:00",tz:"Europe/Madrid",details:"Paseo, compras y brunch.",links:[]},
    {title:"El Escorial ‚Äî Real Biblioteca (opci√≥n B)",when:"07:00‚Äì11:30",where:"San Lorenzo de El Escorial",type:"Cultura",state:"Pendiente",startISO:"2025-11-09T07:00:00",endISO:"2025-11-09T11:30:00",tz:"Europe/Madrid",details:"Visita opcional.",links:[]},
    {title:"Traslado al aeropuerto",when:"14:30",where:"Atocha/Gran V√≠a ‚Üí MAD",type:"Info",state:"Confirmado",startISO:"2025-11-09T14:30:00",endISO:"2025-11-09T15:30:00",tz:"Europe/Madrid"},
    {title:"Vuelo Madrid ‚Üí Par√≠s (ORY)",when:"16:30‚Äì18:25",where:"MAD ‚Üí ORY",type:"Vuelo",state:"Confirmado",startISO:"2025-11-09T16:30:00",endISO:"2025-11-09T18:25:00",tz:"Europe/Paris",details:"Llegada a Saint-Germain-en-Laye y alojamiento.",links:[]}
  ]},
  {date:"Lun ¬∑ 10 nov 2025",city:"Par√≠s",state:"Pendiente",items:[
    {title:"Arco del Triunfo y Campos El√≠seos",when:"09:30‚Äì11:30",where:"Charles de Gaulle ‚Äì √âtoile",type:"Paseo",state:"Info",startISO:"2025-11-10T09:30:00",endISO:"2025-11-10T11:30:00",tz:"Europe/Paris"},
    {title:"Torre Eiffel (cima por ascensor)",when:"13:00‚Äì15:00",where:"Champ de Mars",type:"Monumento",state:"Pendiente",startISO:"2025-11-10T13:00:00",endISO:"2025-11-10T15:00:00",tz:"Europe/Paris",details:"Atardecer + encendido."},
    {title:"Plaza Trocad√©ro (mirador)",when:"16:00‚Äì17:00",where:"Trocad√©ro",type:"Paseo",state:"Info",startISO:"2025-11-10T16:00:00",endISO:"2025-11-10T17:00:00",tz:"Europe/Paris"},
    {title:"Royal Souvenirs",when:"18:00‚Äì19:30",where:"5 Rue Lagrange",type:"Info",state:"Info",startISO:"2025-11-10T18:00:00",endISO:"2025-11-10T19:30:00",tz:"Europe/Paris",details:"Souvenirs originales."},
    {title:"Cena opcional ‚Äî La Petite Hostellerie",when:"Noche",where:"35 Rue de la Harpe (Barrio Latino)",type:"Cultura",state:"Info",startISO:"2025-11-10T20:00:00",endISO:"2025-11-10T21:30:00",tz:"Europe/Paris"}
  ]},
  {date:"Mar ¬∑ 11 nov 2025",city:"Versalles",state:"Confirmado",items:[
    {title:"Palacio y jardines de Versalles",when:"09:30‚Äì16:30",where:"Ch√¢teau de Versailles",type:"Museo",state:"Confirmado",startISO:"2025-11-11T09:30:00",endISO:"2025-11-11T16:30:00",tz:"Europe/Paris",details:"Entrada confirmada."}
  ]},
  {date:"Mi√© ¬∑ 12 nov 2025",city:"Par√≠s",state:"Confirmado",items:[
    {title:"Museo del Louvre",when:"11:30‚Äì14:30",where:"Pir√°mide del Louvre",type:"Museo",state:"Confirmado",startISO:"2025-11-12T11:30:00",endISO:"2025-11-12T14:30:00",tz:"Europe/Paris",details:"Entrada confirmada."},
    {title:"√éle de la Cit√© (Notre-Dame / Sainte-Chapelle)",when:"15:00‚Äì16:00",where:"Cit√©",type:"Paseo",state:"Info",startISO:"2025-11-12T15:00:00",endISO:"2025-11-12T16:00:00",tz:"Europe/Paris"},
    {title:"Terraza Galeries Lafayette",when:"16:30‚Äì17:30",where:"40 Bd Haussmann",type:"Paseo",state:"Info",startISO:"2025-11-12T16:30:00",endISO:"2025-11-12T17:30:00",tz:"Europe/Paris"},
    {title:"Montmartre + Sacr√©-C≈ìur",when:"18:30‚Äì20:00",where:"Montmartre",type:"Paseo",state:"Info",startISO:"2025-11-12T18:30:00",endISO:"2025-11-12T20:00:00",tz:"Europe/Paris"}
  ]},
  {date:"Jue ¬∑ 13 nov 2025",city:"Par√≠s",state:"Confirmado",items:[
    {title:"Disneyland Paris",when:"08:30‚Äì20:00",where:"Marne-la-Vall√©e ‚Äî Chessy",type:"Parque",state:"Confirmado",startISO:"2025-11-13T08:30:00",endISO:"2025-11-13T20:00:00",tz:"Europe/Paris",details:"Salida 06:45 con RER A (~1h 15). Entrada confirmada."}
  ]},
  {date:"Vie ¬∑ 14 nov 2025",city:"Par√≠s",state:"Pendiente",items:[
    {title:"Le Marais + Place des Vosges",when:"09:00‚Äì11:00",where:"Le Marais",type:"Paseo",state:"Info",startISO:"2025-11-14T09:00:00",endISO:"2025-11-14T11:00:00",tz:"Europe/Paris"},
    {title:"Museo de Orsay",when:"11:30‚Äì14:30",where:"Mus√©e d'Orsay",type:"Museo",state:"Confirmado",startISO:"2025-11-14T11:30:00",endISO:"2025-11-14T14:30:00",tz:"Europe/Paris",details:"Entrada confirmada."},
    {title:"Crucero Sena con cena",when:"19:30‚Äì21:00",where:"Bateaux (zona Pont d'Alma)",type:"Crucero",state:"Pendiente",startISO:"2025-11-14T19:30:00",endISO:"2025-11-14T21:00:00",tz:"Europe/Paris"}
  ]},
  {date:"S√°b ¬∑ 15 nov 2025",city:"Traslado",state:"Confirmado",items:[
    {title:"Vuelo Par√≠s (ORY) ‚Üí Madrid",when:"17:15‚Äì19:15",where:"ORY ‚Üí MAD",type:"Vuelo",state:"Confirmado",startISO:"2025-11-15T17:15:00",endISO:"2025-11-15T19:15:00",tz:"Europe/Madrid",details:"Noche libre: paseo/tapas por Gran V√≠a."}
  ]},
  {date:"Dom ¬∑ 16 nov 2025",city:"Madrid",state:"Info",items:[
    {title:"Excursi√≥n a Toledo (AVE ida y vuelta)",when:"07:30‚Äì13:10",where:"Atocha ‚Üî Toledo",type:"Cultura",state:"Info",startISO:"2025-11-16T07:30:00",endISO:"2025-11-16T13:10:00",tz:"Europe/Madrid"},
    {title:"Compras Gran V√≠a",when:"15:00‚Äì17:00",where:"Primark Gran V√≠a 32 y tiendas cercanas",type:"Paseo",state:"Info",startISO:"2025-11-16T15:00:00",endISO:"2025-11-16T17:00:00",tz:"Europe/Madrid"},
    {title:"Cena recomendada",when:"Noche",where:"La Petisquer√≠a / El Duero / Sierra Bar",type:"Cultura",state:"Info",startISO:"2025-11-16T20:00:00",endISO:"2025-11-16T21:30:00",tz:"Europe/Madrid"}
  ]},
  {date:"Lun ¬∑ 17 nov 2025",city:"Vuelo",state:"Confirmado",items:[
    {title:"Vuelo Madrid ‚Üí Lima",when:"00:45",where:"MAD ‚Üí LIM",type:"Vuelo",state:"Confirmado",startISO:"2025-11-17T00:45:00",endISO:"2025-11-17T12:45:00",tz:"America/Lima",details:"Fin del viaje."}
  ]}
];

/* ===== Utils ===== */
const pad=n=>n<10?("0"+n):(""+n);
function toGoogleCalendarURL({title,startISO,endISO,tz,where,details}){
  const s=new Date(startISO), e=new Date(endISO||s.getTime()+90*60000);
  const fmt=d=> d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+"Z";
  const p=new URLSearchParams({action:"TEMPLATE",text:title,dates:fmt(s)+"/"+fmt(e),details:details||"",location:where||"",ctz:tz||"Europe/Paris"});
  return "https://calendar.google.com/calendar/render?"+p.toString();
}
const googleMapsURL=q=>"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(q||"Paris");
function el(tag,attrs={},kids=[]){const n=document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{if(k==="class")n.className=v;else if(k==="text")n.textContent=v;else if(k==="html")n.innerHTML=v;else n.setAttribute(k,v);});
  (Array.isArray(kids)?kids:[kids]).forEach(k=>k&&n.appendChild(k));return n}

/* -------- ITINERARIO -------- */
const daysBox=document.getElementById('days');
function renderDays(filter="all"){
  if(!daysBox) return; daysBox.innerHTML="";
  DAYS.forEach(day=>{
    const dayCard=el("section",{class:"day reveal","data-city":day.city,"data-state":day.state});
    const hdr=el("div",{class:"day__hdr"},[
      el("div",{class:"date",text:day.date}),
      el("div",{class:"city",text:day.city}),
      el("div",{class:"state "+(day.state==="Confirmado"?"ok":day.state==="Pendiente"?"pend":day.state==="Vuelo"?"fly":"") ,text:day.state})
    ]);
    const evBox=el("div",{class:"events"});
    day.items.forEach(ev=>{
      const match=(filter==="all")||[day.city,day.state,ev.type,ev.state].includes(filter)||
        (ev.title+ev.where).toLowerCase().includes(String(filter).toLowerCase());
      if(!match) return;
      const icon=ICONS[ev.type]||"üìç";
      const row1=el("div",{class:"ev__row"},[
        el("h4",{},[el("span",{class:"icon"},[el("span",{class:"ico",text:icon})]),document.createTextNode(ev.title)]),
        el("span",{class:"pill "+(ev.state==="Confirmado"?"ok":ev.state==="Pendiente"?"pend":ev.type==="Vuelo"?"fly":""),text:(ev.state==="Confirmado"?"Confirmado":ev.state==="Pendiente"?"Pendiente":ev.type)}),
        el("span",{class:"pill when",text:"üïí "+(fmtTime(ev)||"‚âà 10:00")}),
        el("span",{class:"pill where",text:"üìç "+(ev.where||"")})
      ]);
      const row2=el("div",{class:"ev__row"},[
        el("div",{class:"muted",text:ev.details||""}),
        el("div",{class:"act"},[
          ev.startISO?el("a",{href:toGoogleCalendarURL(ev),target:"_blank",class:"btn-mini",text:"‚ûï Google Cal"}):null,
          el("a",{href:googleMapsURL(ev.where),target:"_blank",class:"btn-mini mini-map",text:"üó∫Ô∏è GMaps"})
        ])
      ]);
      evBox.appendChild(el("article",{class:"ev","data-type":ev.type,"data-state":ev.state},[row1,row2]));
    });
    dayCard.append(hdr,evBox); daysBox.appendChild(dayCard);
  });
}
function fmtTime(ev){
  if(ev.startISO){ const d=new Date(ev.startISO); return pad(d.getHours())+":"+pad(d.getMinutes()); }
  const m=String(ev.when||"").match(/(\d{1,2}:\d{2})/); if(m) return m[1];
  const t=String(ev.when||"").toLowerCase();
  if(t.includes("ma√±ana")) return "‚âà 10:00";
  if(t.includes("tarde")) return "‚âà 16:00";
  if(t.includes("noche")) return "‚âà 20:00";
  return null;
}

/* Filtros Itinerario */
const filters=document.getElementById('filters');
if(filters){
  filters.addEventListener('click',e=>{
    const b=e.target.closest('.tag'); if(!b) return;
    [...filters.querySelectorAll('.tag')].forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    renderDays(b.dataset.filter);
    window.scrollTo({top:document.querySelector('.days').offsetTop-60,behavior:'smooth'});
  });
}

/* Notas & Checklist */
const CHECKS=[
  {id:"eiffel",label:"Comprar Torre Eiffel (10 nov ¬∑ 13:00)",url:"https://www.toureiffel.paris/"},
  {id:"sena",label:"Reservar Crucero Sena con cena (14 nov ¬∑ 19:30)",url:"https://www.bateaux-mouches.fr/es/reservas"},
  {id:"metro",label:"Cargar Navigo/metro (Par√≠s)"},
  {id:"euros",label:"Cambiar euros (efectivo diario)"},
  {id:"docs",label:"Guardar PDFs/QRs de entradas en el m√≥vil"}
];
const notes=document.getElementById('notes'); const saveNotes=document.getElementById('saveNotes'); const checklist=document.getElementById('checklist');
if(notes){ notes.value=localStorage.getItem('trip.notes')||""; }
if(saveNotes){ saveNotes.addEventListener('click',()=>{localStorage.setItem('trip.notes',notes.value);saveNotes.textContent="‚úÖ Guardado";setTimeout(()=>saveNotes.textContent="üíæ Guardar",1200);}); }
function renderChecklist(){
  if(!checklist) return;
  checklist.innerHTML="";
  CHECKS.forEach(item=>{
    const wrap=el("label",{class:"check"});
    const box=el("input",{type:"checkbox"});
    box.checked=(localStorage.getItem('check.'+item.id)==="1");
    box.addEventListener('change',()=>localStorage.setItem('check.'+item.id, box.checked?"1":"0"));
    const txt=el("div",{},[el("div",{text:item.label}), item.url?el("a",{href:item.url,target:"_blank",text:"Abrir enlace"}):null]);
    wrap.append(box,txt); checklist.appendChild(wrap);
  });
}

/* ======== RECORRIDO (acorde√≥n de eventos) ======== */
const rBox=document.getElementById('r-days');
function renderRecorrido(){
  rBox.innerHTML="";
  DAYS.forEach((day)=>{
    const items=(day.items||[]).slice().sort((a,b)=> new Date(a.startISO||0)-new Date(b.startISO||0));
    const cont=el("section",{class:"r-day", "data-city":day.city});
    const vline=el("div",{class:"r-day-line"}); cont.appendChild(vline);

    const hdr=el("div",{class:"r-hdr"},[
      el("div",{class:"r-date",html:`${day.date}<span class="r-meta">${items.length?items.length+" evento(s)":"Sin actividades"}</span>`}),
      el("div",{class:"r-center"},[el("div",{class:"r-dot",text:"‚Ä¢"})]),
      el("div",{},[el("span",{class:"r-city",text:day.city}),el("span",{class:"r-chev",text:"  ‚ñæ"})])
    ]);
    cont.appendChild(hdr);

    const panel=el("div",{class:"r-panel"});
    const events=el("div",{class:"r-events"});
    const rail=el("div",{class:"r-rail"}); events.appendChild(rail);

    const anchors=[];
    if(items.length===0){
      const row=el("div",{class:"r-row"},[
        el("div",{class:"r-time",text:"‚Äî"}),
        el("div",{class:"r-anchor"}),
        el("div",{},[
          el("div",{class:"r-title",text:"Sin actividades"}),
          el("div",{class:"r-desc",text:"No hay eventos para este d√≠a."})
        ])
      ]);
      anchors.push({el:row.children[1],green:false,txt:"‚Äî"});
      events.appendChild(row);
    }else{
      items.forEach(ev=>{
        const tt=fmtTime(ev)||"‚âà 10:00";
        const row=el("div",{class:"r-row"},[
          el("div",{class:"r-time",text:tt}),
          el("div",{class:"r-anchor"}),
          el("div",{},[
            el("div",{class:"r-title",html: `${ev.title}${ev.state?` <span class="r-chip">${ev.state}</span>`:""}`}),
            el("div",{class:"r-desc",text: ev.where?`üìç ${ev.where}`:""})
          ])
        ]);
        anchors.push({el:row.children[1],green:(ev.type==="Vuelo"),txt:tt});
        events.appendChild(row);
      });
    }
    panel.appendChild(events);
    cont.appendChild(panel);

    function toggle(){
      cont.classList.toggle("open");
      if(cont.classList.contains("open")) requestAnimationFrame(()=>layoutRail(events,rail,anchors));
      else { rail.innerHTML=""; }
    }
    hdr.addEventListener("click",toggle);
    rBox.appendChild(cont);
  });
}
function layoutRail(container,rail,anchors){
  rail.innerHTML="";
  const crect=container.getBoundingClientRect();
  const pts=anchors.map(a=>{const r=a.el.getBoundingClientRect();return{y:r.top-crect.top,green:a.green,txt:a.txt};});
  if(!pts.length) return;
  // First segment from top to first node
  const makeLabel=(y,txt)=>{
    const lab=document.createElement("div"); lab.className="r-label"; lab.style.top=`${y}px`; lab.textContent=txt; rail.appendChild(lab);
  };
  // Draw nodes and labels, and segments between
  if(pts.length===1){
    addNode(rail,pts[0].y,pts[0].green); makeLabel(pts[0].y, pts[0].txt); addSeg(rail,Math.max(pts[0].y-18,0),36,pts[0].green); return;
  }
  addSeg(rail,0,Math.max(pts[0].y,0),pts[0].green);
  for(let i=0;i<pts.length;i++){
    addNode(rail,pts[i].y,pts[i].green);
    makeLabel(pts[i].y, pts[i].txt);
    const next=pts[i+1]; if(next){ addSeg(rail,pts[i].y,next.y-pts[i].y,pts[i].green); }
  }
  const last=pts[pts.length-1]; addSeg(rail,last.y,Math.max(container.offsetHeight-last.y,12),last.green);
}
function addSeg(rail,top,height,green){
  const seg=document.createElement("div");
  seg.className="r-seg "+(green?"r-seg--green":"");
  seg.style.top=`${top}px`; seg.style.height=`${height}px`;
  rail.appendChild(seg);
}
function addNode(rail,centerY,green){
  const n=document.createElement("div");
  n.className="r-node"+(green?" r-node--green":"");
  n.style.top=`${centerY-11}px`;
  n.textContent="‚Ä¢";
  rail.appendChild(n);
}

/* ======== RUTA (MAPA + filtro) ======== */
const P={
  LIM:[-12.0219,-77.1143],
  MAD_BAR:[40.4893,-3.5676],
  MAD_CEN:[40.4169,-3.7033],
  BERN:[40.4531,-3.6883],
  PLAZA_MAYOR:[40.4155,-3.7074],
  SOL:[40.4169,-3.7033],
  SAN_MIGUEL:[40.4154,-3.7094],
  ORY:[48.7262,2.3652],
  HOME_SGL:[48.898,2.093],
  ARC:[48.8738,2.2950],
  EIFFEL:[48.8584,2.2945],
  TROC:[48.8625,2.2871],
  VERS:[48.8049,2.1204],
  LOUVRE:[48.8606,2.3376],
  MONTM:[48.8867,2.3431],
  DLP:[48.8708,2.7817],
  MARAIS:[48.8575,2.3622],
  ORSAY:[48.86,2.3266],
  CRUISE:[48.8630,2.3115],
  TOLEDO:[39.8628,-4.0273],
  ESCORIAL:[40.5909,-4.1470]
};
const ROUTES=[
  {id:'2025-11-06', icon:'üõ´', label:'Jue ¬∑ 6 nov ¬∑ Lima ‚Üí Madrid', points:[{c:P.LIM, t:'LIM'}]},
  {id:'2025-11-07', icon:'üèôÔ∏è', label:'Vie ¬∑ 7 nov ¬∑ Llegada', points:[{c:P.MAD_BAR, t:'MAD Barajas'},{c:P.MAD_CEN, t:'Centro Madrid'}]},
  {id:'2025-11-08', icon:'‚öΩ', label:'S√°b ¬∑ 8 nov ¬∑ Madrid', points:[{c:P.MAD_CEN,t:'Centro'},{c:P.BERN,t:'Bernab√©u'},{c:P.PLAZA_MAYOR,t:'Plaza Mayor / Sol / San Miguel'},{c:P.MAD_CEN,t:'Centro'}]},
  {id:'2025-11-09', icon:'‚úàÔ∏è', label:'Dom ¬∑ 9 nov ¬∑ Madrid ‚Üí Par√≠s', points:[{c:P.MAD_CEN,t:'Centro'},{c:P.ESCORIAL,t:'El Escorial (opcional)'},{c:P.MAD_BAR,t:'MAD'},{c:P.ORY,t:'ORY'},{c:P.HOME_SGL,t:'Saint-Germain-en-Laye'}]},
  {id:'2025-11-10', icon:'üóº', label:'Lun ¬∑ 10 nov ¬∑ Par√≠s cl√°sico', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.ARC,t:'Arco del Triunfo'},{c:P.EIFFEL,t:'Torre Eiffel'},{c:P.TROC,t:'Trocad√©ro'},{c:P.HOME_SGL,t:'Hospedaje'}]},
  {id:'2025-11-11', icon:'üëë', label:'Mar ¬∑ 11 nov ¬∑ Versalles', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.VERS,t:'Versalles'},{c:P.HOME_SGL,t:'Hospedaje'}]},
  {id:'2025-11-12', icon:'üñºÔ∏è', label:'Mi√© ¬∑ 12 nov ¬∑ Par√≠s cultural', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.LOUVRE,t:'Louvre'},{c:P.MONTM,t:'Montmartre'},{c:P.HOME_SGL,t:'Hospedaje'}]},
  {id:'2025-11-13', icon:'üé¢', label:'Jue ¬∑ 13 nov ¬∑ Disneyland', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.DLP,t:'Disneyland Paris'},{c:P.HOME_SGL,t:'Hospedaje'}]},
  {id:'2025-11-14', icon:'üö§', label:'Vie ¬∑ 14 nov ¬∑ Marais ¬∑ Orsay ¬∑ Sena', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.MARAIS,t:'Le Marais'},{c:P.ORSAY,t:'Orsay'},{c:P.CRUISE,t:'Crucero Sena'},{c:P.HOME_SGL,t:'Hospedaje'}]},
  {id:'2025-11-15', icon:'‚úàÔ∏è', label:'S√°b ¬∑ 15 nov ¬∑ Par√≠s ‚Üí Madrid', points:[{c:P.HOME_SGL,t:'Hospedaje'},{c:P.ORY,t:'ORY'},{c:P.MAD_BAR,t:'MAD'},{c:P.MAD_CEN,t:'Centro Madrid'}]},
  {id:'2025-11-16', icon:'üè∞', label:'Dom ¬∑ 16 nov ¬∑ Toledo', points:[{c:P.MAD_CEN,t:'Madrid'},{c:P.TOLEDO,t:'Toledo'},{c:P.MAD_CEN,t:'Madrid'}]},
  {id:'2025-11-17', icon:'üõ¨', label:'Lun ¬∑ 17 nov ¬∑ Regreso', points:[{c:P.MAD_CEN,t:'Centro Madrid'},{c:P.MAD_BAR,t:'MAD'},{c:P.LIM,t:'LIM'}]}
];

let map, routeLayer, markersLayer, rutaInited=false;
const dayList = document.getElementById('dayList');
const curLabel = document.getElementById('currentLabel');
const acc = document.getElementById('dayFilter');
const WEEK = ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
const MONTH = ['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'];
function fmtDateES(iso){ const [y,m,d]=iso.split('-').map(Number); const f=new Date(y,m-1,d); return `${WEEK[f.getDay()]} ¬∑ ${d} ${MONTH[m-1]} ${y}`; }
function headline(points){
  if(points.length===1) return points[0].t;
  const a=points[0].t, b=points[points.length-1].t;
  if(a===b && points.length>1) return `${a} ‚Üí ${points[1].t}`;
  return `${a} ‚Üí ${b}`;
}

function ensureMap(){
  if(rutaInited) { map.invalidateSize(); return; }
  map = L.map('map',{zoomControl:true, scrollWheelZoom:true});
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap'}).addTo(map);
  map.setView([44,2],5);
  routeLayer=L.layerGroup().addTo(map);
  markersLayer=L.layerGroup().addTo(map);
  const ctr=document.createElement('div'); ctr.className='controls';
  ctr.innerHTML=`
    <button class="btn-float" id="btnFit" title="Centrar ruta">üéØ Centrar</button>
    <button class="btn-float" id="btnReset" title="Reset">‚Üª Reset</button>
  `;
  document.getElementById('map').appendChild(ctr);
  document.getElementById('btnFit').addEventListener('click',fitRoute);
  document.getElementById('btnReset').addEventListener('click',resetRoute);
  dayList.innerHTML='';
  ROUTES.forEach(d=>{
    const row=document.createElement('button');
    row.className='route-item';
    const dateTxt=fmtDateES(d.id);
    const main=headline(d.points);
    const count=d.points.length;
    row.innerHTML=`
      <span class="icoDay">${d.icon||'üìç'}</span>
      <span class="dateTag">${dateTxt}</span>
      <span class="hint">${main}</span>
      <span class="sub">¬∑ ${d.label}</span>
      <span class="count">${count} parada${count===1?'':'s'}</span>
    `;
    row.addEventListener('click',()=>{
      drawDay(d);
      curLabel.textContent = `${dateTxt} ¬∑ ${main} ¬∑ ${count} parada${count===1?'':'s'}`;
      acc.removeAttribute('open');
    });
    dayList.appendChild(row);
  });
  rutaInited=true;
}
function clearLayers(){ routeLayer.clearLayers(); markersLayer.clearLayers(); }
function drawDay(day){
  clearLayers();
  const latlngs = day.points.map(p=>p.c);
  L.polyline(latlngs,{color:'#2f70ff',weight:6,opacity:.9}).addTo(routeLayer);
  day.points.forEach((p,i)=>{
    const div = L.divIcon({className:'num', html:String(i+1), iconSize:[26,26], iconAnchor:[13,13]});
    L.marker(p.c,{icon:div,title:p.t}).addTo(markersLayer).bindPopup(`<b>${i+1}. ${p.t}</b>`);
  });
  fitRoute();
}
function fitRoute(){
  let b=null; routeLayer.eachLayer(l=>{ if(l.getBounds) b=b? b.extend(l.getBounds()) : l.getBounds(); });
  if(b) map.fitBounds(b,{padding:[40,40]});
}
function resetRoute(){
  clearLayers();
  curLabel.textContent='‚Äî';
  map.setView([44,2],5);
  acc.setAttribute('open','');
}

/* ===== Pesta√±as + hero ===== */
const segmented=document.getElementById('segmented');
const thumb=document.getElementById('thumb');
const tabs=Array.from(segmented.querySelectorAll('.seg'));
const views={
  itinerario:document.getElementById('view-itinerario'),
  recorrido:document.getElementById('view-recorrido'),
  ruta:document.getElementById('view-ruta'),
  tips:document.getElementById('view-tips')
};
const heroHeads=document.getElementById('hero-heads');
const heroCar=document.getElementById('hero-car');

function moveThumbTo(el){
  const {left,width}=el.getBoundingClientRect();
  const wrapLeft=segmented.getBoundingClientRect().left + segmented.scrollLeft;
  thumb.style.width=width+'px';
  thumb.style.left=(left - wrapLeft + segmented.scrollLeft)+'px';
}
function setHeroFor(key){
  const showHeads=(key==='itinerario' || key==='tips');
  heroHeads.style.display= showHeads ? 'flex' : 'none';
  heroHeads.setAttribute('aria-hidden', String(!showHeads));
  heroCar.style.display  = showHeads ? 'none' : 'grid';
  heroCar.setAttribute('aria-hidden', String(showHeads));
}
function revealObserve(){
  const io=new IntersectionObserver(es=>es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('show');io.unobserve(e.target);}}),{threshold:.15});
  document.querySelectorAll('.reveal,.day').forEach(n=>io.observe(n));
}

tabs.forEach(t=>{
  t.addEventListener('click',()=>{
    tabs.forEach(x=>x.setAttribute('aria-selected','false'));
    t.setAttribute('aria-selected','true');
    const key=t.dataset.tab;
    Object.entries(views).forEach(([k,elv])=>elv.classList.toggle('active',k===key));
    if(key==='recorrido') renderRecorrido();
    if(key==='ruta') { ensureMap(); setTimeout(()=>map.invalidateSize(), 50); }
    if(key==='itinerario') { renderDays('all'); }
    if(key==='tips') { /* static */ }
    setHeroFor(key); moveThumbTo(t);
    window.scrollTo({top:document.querySelector('.views').offsetTop-60,behavior:'smooth'});
  });
});
window.addEventListener('load',()=>{const cur=tabs.find(b=>b.getAttribute('aria-selected')==='true'); if(cur) moveThumbTo(cur);});
window.addEventListener('resize',()=>{const cur=tabs.find(b=>b.getAttribute('aria-selected')==='true'); if(cur) moveThumbTo(cur);});
segmented.addEventListener('scroll',()=>{const cur=tabs.find(b=>b.getAttribute('aria-selected')==='true'); if(cur) moveThumbTo(cur);});

/* Init */
function initChecklist(){ try{ renderChecklist(); }catch{ if(checklist) checklist.innerHTML='<div class="muted">Checklist no disponible en modo privado.</div>'; } }
renderDays("all"); initChecklist(); revealObserve();
</script>
</body>
</html>
